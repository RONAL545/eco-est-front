<div class="dashboard-container">
  <!-- Filters Section -->
  <div class="filters-section">
    <div class="filters-row">
      <mat-form-field appearance="outline" class="filter-input">
        <mat-label>Sede - Pabellón</mat-label>
        <lucide-icon [img]="Building2" matPrefix class="prefix-icon"></lucide-icon>
        <mat-select>
          <mat-option value="general">General</mat-option>
          <mat-option value="santa-catalina">Santa Catalina</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" class="filter-input">
        <mat-label>Pabellón - Espacio</mat-label>
        <lucide-icon [img]="DoorOpen" matPrefix class="prefix-icon"></lucide-icon>
        <mat-select>
          <mat-option value="todos">Todos</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline" class="filter-input date-range">
        <mat-label>Rango de Fechas</mat-label>
        <lucide-icon [img]="Calendar" matPrefix class="prefix-icon"></lucide-icon>
        <mat-date-range-input [formGroup]="dateRangeForm" [rangePicker]="rangePicker">
          <input matStartDate formControlName="start" placeholder="Fecha inicio">
          <input matEndDate formControlName="end" placeholder="Fecha fin" (dateChange)="applyDateFilter()">
        </mat-date-range-input>
        <mat-datepicker-toggle matIconSuffix [for]="rangePicker"></mat-datepicker-toggle>
        <mat-date-range-picker #rangePicker></mat-date-range-picker>
      </mat-form-field>

      <button mat-flat-button color="primary" class="action-button" (click)="exportData()">
        <lucide-icon [img]="Download" class="button-icon"></lucide-icon>
        Exportar
      </button>
    </div>
  </div>

  <!-- Content Grid -->
  <div class="content-grid">
    <!-- Table Card -->
    <mat-card class="table-card">
      <mat-card-header>
        <div class="card-title-wrapper">
          <div class="title-icon-wrapper">
            <lucide-icon [img]="Table2" class="title-icon"></lucide-icon>
          </div>
          <mat-card-title>Datos de Reciclaje por Pabellón</mat-card-title>
        </div>
      </mat-card-header>
      <mat-card-content>
        <!-- Vista Desktop: Tabla -->
        <div class="table-container desktop-table">
          <table mat-table [dataSource]="dataSource" class="data-table">
            <ng-container matColumnDef="pabellon">
              <th mat-header-cell *matHeaderCellDef>Pabellón</th>
              <td mat-cell *matCellDef="let row" class="cell-pabellon">{{row.pabellon}}</td>
            </ng-container>

            <ng-container matColumnDef="plastico">
              <th mat-header-cell *matHeaderCellDef>Plástico (kg)</th>
              <td mat-cell *matCellDef="let row" class="cell-value">{{row.plastico}}</td>
            </ng-container>

            <ng-container matColumnDef="carton">
              <th mat-header-cell *matHeaderCellDef>Cartón/Papel (kg)</th>
              <td mat-cell *matCellDef="let row" class="cell-value">{{row.carton}}</td>
            </ng-container>

            <ng-container matColumnDef="vidrio">
              <th mat-header-cell *matHeaderCellDef>Vidrio (kg)</th>
              <td mat-cell *matCellDef="let row" class="cell-value">{{row.vidrio}}</td>
            </ng-container>

            <ng-container matColumnDef="organico">
              <th mat-header-cell *matHeaderCellDef>R. Orgánico (kg)</th>
              <td mat-cell *matCellDef="let row" class="cell-value">{{row.organico}}</td>
            </ng-container>

            <ng-container matColumnDef="metal">
              <th mat-header-cell *matHeaderCellDef>Metal (kg)</th>
              <td mat-cell *matCellDef="let row" class="cell-value">{{row.metal}}</td>
            </ng-container>

            <ng-container matColumnDef="no_aprovechable">
              <th mat-header-cell *matHeaderCellDef>No Aprovechable (kg)</th>
              <td mat-cell *matCellDef="let row" class="cell-value">{{row.no_aprovechable}}</td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="table-row"></tr>
          </table>
        </div>

        <!-- Vista Mobile: Cards -->
        <div class="mobile-cards">
          <div class="data-card" *ngFor="let row of dataSource">
            <div class="data-card-header">
              <h3>{{ row.pabellon }}</h3>
            </div>
            <div class="data-card-body">
              <div class="data-row">
                <span class="data-label">Plástico:</span>
                <span class="data-value">{{ row.plastico }} kg</span>
              </div>
              <div class="data-row">
                <span class="data-label">Cartón/Papel:</span>
                <span class="data-value">{{ row.carton }} kg</span>
              </div>
              <div class="data-row">
                <span class="data-label">Vidrio:</span>
                <span class="data-value">{{ row.vidrio }} kg</span>
              </div>
              <div class="data-row">
                <span class="data-label">R. Orgánico:</span>
                <span class="data-value">{{ row.organico }} kg</span>
              </div>
              <div class="data-row">
                <span class="data-label">Metal:</span>
                <span class="data-value">{{ row.metal }} kg</span>
              </div>
              <div class="data-row">
                <span class="data-label">No Aprovechable:</span>
                <span class="data-value">{{ row.no_aprovechable }} kg</span>
              </div>
            </div>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Chart Card -->
    <mat-card class="chart-card">
      <mat-card-header>
        <div class="card-title-wrapper">
          <div class="title-icon-wrapper">
            <lucide-icon [img]="PieChart" class="title-icon"></lucide-icon>
          </div>
          <mat-card-title>Distribución por Categoría</mat-card-title>
        </div>
      </mat-card-header>
      <mat-card-content>
        <div class="chart-wrapper">
          <canvas baseChart
                  [data]="pieChartData"
                  [options]="pieChartOptions"
                  type="pie">
          </canvas>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>
